===== SLURM INFO =====
JOBID: 21521709
NODELIST: fc10902
CPUS_PER_TASK: 12
GPUS_ON_NODE: 1
SUBMIT_DIR: /project/6061446/kbas/Graphnet-Applications/Training/EnergyReconstruction_EventPulseSeries_nonoise/initiative2
======================
The following modules were not unloaded:
  (Use "module --force purge" to unload all):

  1) CCconfig        6)  ucx/1.14.1         11) flexiblas/3.3.1
  2) gentoo/2023     7)  libfabric/1.18.0   12) aocl-blas/5.1
  3) gcccore/.12.3   8)  pmix/4.2.4         13) aocl-lapack/5.1
  4) gcc/12.3        9)  ucc/1.2.0          14) StdEnv/2023
  5) hwloc/2.9.1     10) openmpi/4.1.5
===== ENV SETUP =====
PWD: /project/def-nahee/kbas/pone_offline
Activating venv: /project/def-nahee/kbas/pone_offline/graphnet_env/bin/activate
Python: /project/6061446/kbas/pone_offline/graphnet_env/bin/python3
sys.executable = /project/6061446/kbas/pone_offline/graphnet_env/bin/python3
torch: 2.6.0
cuda available: True
cuda device: NVIDIA H100 80GB HBM3 MIG 3g.40gb
===== GPU INFO =====
Mon Feb  2 08:46:20 2026       
+-----------------------------------------------------------------------------------------+
| NVIDIA-SMI 580.65.06              Driver Version: 580.65.06      CUDA Version: 13.0     |
+-----------------------------------------+------------------------+----------------------+
| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |
| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |
|                                         |                        |               MIG M. |
|=========================================+========================+======================|
|   0  NVIDIA H100 80GB HBM3          On  |   00000000:06:00.0 Off |                   On |
| N/A   27C    P0            169W /  700W |     306MiB /  81559MiB |     N/A      Default |
|                                         |                        |              Enabled |
+-----------------------------------------+------------------------+----------------------+

+-----------------------------------------------------------------------------------------+
| MIG devices:                                                                            |
+------------------+----------------------------------+-----------+-----------------------+
| GPU  GI  CI  MIG |              Shared Memory-Usage |        Vol|        Shared         |
|      ID  ID  Dev |                Shared BAR1-Usage | SM     Unc| CE ENC  DEC  OFA  JPG |
|                  |                                  |        ECC|                       |
|==================+==================================+===========+=======================|
|  0    2   0   0  |              44MiB / 40448MiB    | 60      0 |  3   0    3    0    3 |
|                  |               0MiB / 24740MiB    |           |                       |
+------------------+----------------------------------+-----------+-----------------------+

+-----------------------------------------------------------------------------------------+
| Processes:                                                                              |
|  GPU   GI   CI              PID   Type   Process name                        GPU Memory |
|        ID   ID                                                               Usage      |
|=========================================================================================|
|  No running processes found                                                             |
+-----------------------------------------------------------------------------------------+
====================
===== RUN =====
[rank: 0] Seed set to 20260202

========== CONFIG ==========
seed: 20260202
train_path: /project/def-nahee/kbas/POM_Response_Parquet/merged/train_reindexed
val_path: /project/def-nahee/kbas/POM_Response_Parquet/merged/val_reindexed
test_path: /project/def-nahee/kbas/POM_Response_Parquet/merged/test_reindexed
pulsemaps: features
truth_table: truth
features: ('pmt_x', 'pmt_y', 'pmt_z', 'dom_time', 'charge')
truth: ('energy',)
batch_size: 128
num_workers: 8
multiprocessing_context: spawn
persistent_workers: True
pin_memory: True
max_epochs: 75
base_lr: 1e-05
peak_lr: 0.001
early_stopping_patience: 15
accumulate_grad_batches: 8
nb_neighbours: 8
global_pooling_schemes: ('min', 'max', 'mean', 'sum')
add_global_variables_after_pooling: True
add_norm_layer: False
skip_readout: False
transform_support: (10.0, 100000000.0)
save_dir: /project/6061446/kbas/Graphnet-Applications/Training/EnergyReconstruction_EventPulseSeries_nonoise/initiative2
test_csv_name: test_predictions.csv
metrics_dir: /project/6061446/kbas/Graphnet-Applications/Training/EnergyReconstruction_EventPulseSeries_nonoise/initiative2
metrics_name: metrics.csv
============================

[Data] Building data_representation (KNNGraph + PONE robust scaling)
[1;34mgraphnet[0m [MainProcess] [32mINFO    [0m 2026-02-02 08:48:47 - PONE.__init__ - Writing log to [1mlogs/graphnet_20260202-084847.log[0m
[Data] Creating ParquetDataset(s)
[Data] Creating DataLoader(s)
[Data] len(train_loader) = 2512 batches/epoch (drop_last=True)
[Data] len(val_loader)   = 312 batches/epoch
[Data] len(test_loader)  = 324 batches
[Sanity] batch type: <class 'abc.DataBatch'>
[Sanity] graphs in one train batch: 127 (expected 128)
[Sanity][WARN] graphs != batch_size. Might be OK, but verify dataset returns single-event graphs.
[Train] steps/epoch (batches)   = 2512
[Train] accumulate_grad_batches = 8
[Train] steps/epoch (optimizer) = 314
[Model] Building DynEdge backbone
[Model] Building energy task (log10 target + LogCosh)
[LR] Schedule setup:
     base_lr=1e-05, peak_lr=0.001 (factor=100)
     steps/epoch (optimizer) = 314
     warmup_steps            = 157 (first 50% of epoch 0)
     total_steps             = 23550 (for 75 epochs)

[Train] Starting Trainer.fit()
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
/project/6061446/kbas/pone_offline/graphnet_env/lib/python3.10/site-packages/pytorch_lightning/trainer/connectors/logger_connector/logger_connector.py:76: Starting from v1.9.0, `tensorboardX` has been removed as a dependency of the `pytorch_lightning` package, due to potential conflicts with other packages in the ML ecosystem. For this reason, `logger=True` will use `CSVLogger` as the default logger, unless the `tensorboard` or `tensorboardX` packages are found. Please `pip install lightning[extra]` or one of them to enable TensorBoard support by default
You are using a CUDA device ('NVIDIA H100 80GB HBM3 MIG 3g.40gb') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [MIG-7eacae51-f82b-50ac-96ce-e387e86b9ee1]

  | Name                 | Type       | Params | Mode 
------------------------------------------------------------
0 | _tasks               | ModuleList | 129    | train
1 | _data_representation | KNNGraph   | 0      | train
2 | backbone             | DynEdge    | 1.4 M  | train
------------------------------------------------------------
1.4 M     Trainable params
0         Non-trainable params
1.4 M     Total params
5.501     Total estimated model params size (MB)
36        Modules in train mode
0         Modules in eval mode
SLURM auto-requeueing enabled. Setting signal handlers.
Metric val_loss improved. New best score: 0.145
[1;34mgraphnet[0m [MainProcess] [32mINFO    [0m 2026-02-02 09:11:20 - StandardModel.save_state_dict - Model state_dict saved to /project/6061446/kbas/Graphnet-Applications/Training/EnergyReconstruction_EventPulseSeries_nonoise/initiative2/best_model.pth[0m
Metric val_loss improved by 0.024 >= min_delta = 0.0. New best score: 0.120
[1;34mgraphnet[0m [MainProcess] [32mINFO    [0m 2026-02-02 09:30:39 - StandardModel.save_state_dict - Model state_dict saved to /project/6061446/kbas/Graphnet-Applications/Training/EnergyReconstruction_EventPulseSeries_nonoise/initiative2/best_model.pth[0m
Metric val_loss improved by 0.014 >= min_delta = 0.0. New best score: 0.107
[1;34mgraphnet[0m [MainProcess] [32mINFO    [0m 2026-02-02 09:49:51 - StandardModel.save_state_dict - Model state_dict saved to /project/6061446/kbas/Graphnet-Applications/Training/EnergyReconstruction_EventPulseSeries_nonoise/initiative2/best_model.pth[0m
Metric val_loss improved by 0.000 >= min_delta = 0.0. New best score: 0.107
[1;34mgraphnet[0m [MainProcess] [32mINFO    [0m 2026-02-02 10:29:16 - StandardModel.save_state_dict - Model state_dict saved to /project/6061446/kbas/Graphnet-Applications/Training/EnergyReconstruction_EventPulseSeries_nonoise/initiative2/best_model.pth[0m
Metric val_loss improved by 0.009 >= min_delta = 0.0. New best score: 0.098
[1;34mgraphnet[0m [MainProcess] [32mINFO    [0m 2026-02-02 11:08:52 - StandardModel.save_state_dict - Model state_dict saved to /project/6061446/kbas/Graphnet-Applications/Training/EnergyReconstruction_EventPulseSeries_nonoise/initiative2/best_model.pth[0m
Metric val_loss improved by 0.001 >= min_delta = 0.0. New best score: 0.097
[1;34mgraphnet[0m [MainProcess] [32mINFO    [0m 2026-02-02 11:28:26 - StandardModel.save_state_dict - Model state_dict saved to /project/6061446/kbas/Graphnet-Applications/Training/EnergyReconstruction_EventPulseSeries_nonoise/initiative2/best_model.pth[0m
Metric val_loss improved by 0.002 >= min_delta = 0.0. New best score: 0.095
[1;34mgraphnet[0m [MainProcess] [32mINFO    [0m 2026-02-02 11:47:46 - StandardModel.save_state_dict - Model state_dict saved to /project/6061446/kbas/Graphnet-Applications/Training/EnergyReconstruction_EventPulseSeries_nonoise/initiative2/best_model.pth[0m
Metric val_loss improved by 0.001 >= min_delta = 0.0. New best score: 0.094
[1;34mgraphnet[0m [MainProcess] [32mINFO    [0m 2026-02-02 12:07:12 - StandardModel.save_state_dict - Model state_dict saved to /project/6061446/kbas/Graphnet-Applications/Training/EnergyReconstruction_EventPulseSeries_nonoise/initiative2/best_model.pth[0m
Metric val_loss improved by 0.000 >= min_delta = 0.0. New best score: 0.094
[1;34mgraphnet[0m [MainProcess] [32mINFO    [0m 2026-02-02 12:46:17 - StandardModel.save_state_dict - Model state_dict saved to /project/6061446/kbas/Graphnet-Applications/Training/EnergyReconstruction_EventPulseSeries_nonoise/initiative2/best_model.pth[0m
Metric val_loss improved by 0.003 >= min_delta = 0.0. New best score: 0.091
[1;34mgraphnet[0m [MainProcess] [32mINFO    [0m 2026-02-02 13:44:26 - StandardModel.save_state_dict - Model state_dict saved to /project/6061446/kbas/Graphnet-Applications/Training/EnergyReconstruction_EventPulseSeries_nonoise/initiative2/best_model.pth[0m
Metric val_loss improved by 0.001 >= min_delta = 0.0. New best score: 0.090
[1;34mgraphnet[0m [MainProcess] [32mINFO    [0m 2026-02-02 15:21:05 - StandardModel.save_state_dict - Model state_dict saved to /project/6061446/kbas/Graphnet-Applications/Training/EnergyReconstruction_EventPulseSeries_nonoise/initiative2/best_model.pth[0m
Metric val_loss improved by 0.000 >= min_delta = 0.0. New best score: 0.090
[1;34mgraphnet[0m [MainProcess] [32mINFO    [0m 2026-02-02 16:18:35 - StandardModel.save_state_dict - Model state_dict saved to /project/6061446/kbas/Graphnet-Applications/Training/EnergyReconstruction_EventPulseSeries_nonoise/initiative2/best_model.pth[0m
Metric val_loss improved by 0.000 >= min_delta = 0.0. New best score: 0.090
[1;34mgraphnet[0m [MainProcess] [32mINFO    [0m 2026-02-02 17:16:20 - StandardModel.save_state_dict - Model state_dict saved to /project/6061446/kbas/Graphnet-Applications/Training/EnergyReconstruction_EventPulseSeries_nonoise/initiative2/best_model.pth[0m
Metric val_loss improved by 0.000 >= min_delta = 0.0. New best score: 0.090
[1;34mgraphnet[0m [MainProcess] [32mINFO    [0m 2026-02-02 17:35:20 - StandardModel.save_state_dict - Model state_dict saved to /project/6061446/kbas/Graphnet-Applications/Training/EnergyReconstruction_EventPulseSeries_nonoise/initiative2/best_model.pth[0m
Monitored metric val_loss did not improve in the last 15 records. Best score: 0.090. Signaling Trainer to stop.

[Train] Finished.
[Train] Best model path: /project/6061446/kbas/Graphnet-Applications/Training/EnergyReconstruction_EventPulseSeries_nonoise/initiative2/best_model.pth
[Train] Config path:     /project/6061446/kbas/Graphnet-Applications/Training/EnergyReconstruction_EventPulseSeries_nonoise/initiative2/config.yml

[Test] Starting inference on test set
[Test] model device = cpu
[Test] batch 0/324: N=127 pred_log10 mean=2.985 resid mean=-0.085
[Test] batch 20/324: N=128 pred_log10 mean=2.977 resid mean=-0.114
[Test] batch 40/324: N=126 pred_log10 mean=3.005 resid mean=-0.068
[Test] batch 60/324: N=128 pred_log10 mean=3.054 resid mean=-0.088
[Test] batch 80/324: N=127 pred_log10 mean=2.981 resid mean=-0.064
[Test] batch 100/324: N=128 pred_log10 mean=2.894 resid mean=-0.033
[Test] batch 120/324: N=128 pred_log10 mean=3.096 resid mean=-0.049
[Test] batch 140/324: N=128 pred_log10 mean=2.975 resid mean=-0.055
[Test] batch 160/324: N=128 pred_log10 mean=3.049 resid mean=-0.007
[Test] batch 180/324: N=128 pred_log10 mean=2.946 resid mean=-0.063
[Test] batch 200/324: N=127 pred_log10 mean=2.914 resid mean=-0.029
[Test] batch 220/324: N=128 pred_log10 mean=3.004 resid mean=-0.100
[Test] batch 240/324: N=128 pred_log10 mean=2.914 resid mean=-0.018
[Test] batch 260/324: N=127 pred_log10 mean=2.926 resid mean=0.039
[Test] batch 280/324: N=128 pred_log10 mean=3.028 resid mean=-0.082
[Test] batch 300/324: N=128 pred_log10 mean=2.970 resid mean=-0.036
[Test] batch 320/324: N=128 pred_log10 mean=3.047 resid mean=-0.013

[Test] Wrote CSV: /project/6061446/kbas/Graphnet-Applications/Training/EnergyReconstruction_EventPulseSeries_nonoise/initiative2/test_predictions.csv
[Test] Rows: 41311
[Test] residual_log10 quantiles: p16=-0.3619, p50=0.0060, p84=0.2994, W=0.3306

[Test] CSV head:
  true_energy  pred_log10_energy  pred_energy  residual_log10  event_id
108859.773438           3.042192  1102.025757       -1.994676       242
 14684.890625           4.304098 20141.792969        0.137228       778
   127.363152           2.278529   189.901627        0.173485      1171
  2789.717773           3.842131  6952.338379        0.396571      1634
  3609.210693           2.704424   506.318359       -0.852988      3741
===== DONE =====
